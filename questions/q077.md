# Question ID: q077

## Category
[Platform Basics/Authoring/Development/Maintenance]

## Question
A DevOps engineer notices a high load on the Publish instances. URLs similar to the following hit the publish servers directly and are not cached on dispatcher:
- GET /content/siteA/page1.html?user=test1
- GET /content/siteA/page1.html?user=test2
- GET /content/siteA/page1.html?user1=test3
- GET /content/siteA/page1.html?user2=test4
How should a DevOps engineer configure the dispatcher?

## Options
A) /ignoreUrlParams{/0001 { /glob "*"/type "allow" }/0002 { /glob "test*" /type "deny" }}  <br /> 
B) /ignoreUr|Params{/0001 {/glob "*"/type "deny"} 1/0002 {/glob "test*" type "allow" }}  <br /> 
C) /ignoreUrlParams {/0001 { /glob "*"/type "allow" }/0002 { /glob "user*" /type "deny" }}  <br /> 
D) /ignoreUrlParams{/0001 { /glob "*"/type "deny" }/0002 { /glob "user*" /type "allow" }}  <br /> 

## Correct Answer
C) /ignoreUrlParams {/0001 { /glob "*"/type "allow" }/0002 { /glob "user*" /type "deny" }}

## Explanation
[Detailed explanation of why this answer is correct and why others are incorrect]

## Related Concepts
- https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#caching-and-invalidation
- [Additional resource links]

## Tags
#concept-tag1 #concept-tag2

## Difficulty
[Easy/Medium/Hard]

## Notes
For caching with query parameters, we need:
```
/ignoreUrlParams {
   /0001 { /glob "*" /type "allow" }     # IGNORE all params (cache same version)
   /0002 { /glob "user*" /type "deny" }  # Don't ignore user params (cache different versions)
}
```

So C) is correct: `/ignoreUrlParams {/0001 { /glob "*"/type "allow" }/0002 { /glob "user*" /type "deny" }}`

Because:
1. `allow` in ignoreUrlParams means:
   - IGNORE the parameter
   - Cache same version regardless
   - Treat URLs as identical

2. `deny` in ignoreUrlParams means:
   - DON'T ignore parameter
   - Create different cache entries
   - Treat URLs as different


The best source for understanding **Dispatcher caching rules** and `/ignoreUrlParams` behavior is **Adobe‚Äôs official documentation**:  

üîó **Adobe Dispatcher Documentation:**  
- [Ignore URL Parameters](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#caching-and-invalidation)  

---

### **Key Explanations from Adobe Docs:**
1. **`/ignoreUrlParams` Rule Behavior:**  
   - If **`/glob "*" /type "allow"`** ‚Üí By default, parameters **do not affect caching**, so variations of the same URL **reuse the cached version**.  
   - If **`/glob "user*" /type "deny"`** ‚Üí This means parameters like `user=test1` are **ignored**, ensuring caching works efficiently.  

2. **How Caching Works with URL Parameters:**  
   - If a URL contains **query parameters that are NOT ignored**, Dispatcher **treats them as unique requests** (bad for caching).  
   - If query parameters are **ignored properly**, Dispatcher **caches a single version of the page**.  

3. **Example from Adobe‚Äôs Docs:**  
   - **Bad caching rule:**  
     ```plaintext
     /ignoreUrlParams {
        /0001 { /glob "*" /type "deny" } # Denies all (forces cache misses)
        /0002 { /glob "user*" /type "allow" } # Allows "user*" (creates separate cache entries)
     }
     ```
     - ‚ùå **This forces each unique user parameter to create a new cache entry, increasing Publish load.**  

   - **Best caching rule (recommended approach):**  
     ```plaintext
     /ignoreUrlParams {
        /0001 { /glob "*" /type "allow" } # Cache by default
        /0002 { /glob "user*" /type "deny" } # Ignore "user*" parameters for caching
     }
     ```
     - ‚úÖ **This ensures URLs like `page1.html?user=test1` and `page1.html?user=test2` use the same cached response.**  
     - ‚úÖ **Reduces unnecessary Publish load.**  

---

### **Conclusion:**
üìå **The correct way to configure Dispatcher caching for URLs with dynamic user parameters is:**  
```plaintext
/ignoreUrlParams {
   /0001 { /glob "*" /type "allow" }     
   /0002 { /glob "user*" /type "deny" }
}
```
üöÄ **This ensures optimal caching and prevents unnecessary load on AEM Publish.**  

üîç **Source:** [Adobe Dispatcher Configuration - Ignore URL Parameters](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#caching-and-invalidation)